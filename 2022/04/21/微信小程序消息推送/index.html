<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Axe"><title>微信小程序消息推送 · Axe</title><meta name="description" content="前言无论是短信消息推送还是程序内的消息推送，在大部分互联网产品中都是重要的组成部分，能在很大程度上提高用户的产品体验。
网页上的消息推送一般使用 websocket 进行站内的消息提示。App上一般使用第三方平台提供的收费式的消息推送服务。而微信小程序内部自己集成了一套消息推送的模块，大量的消息推送"><meta name="keywords" content="Javascript,HTML,CSS,Typescript"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><meta name="generator" content="Hexo 5.4.2">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/avatar.jpg" style="width:127px;"><h3 title=""><a href="/">Axe</a></h3><div class="description"><p>不会做饭的厨师不是好程序员</p></div></div></div><ul class="social-links"><li><a target="_blank" rel="noopener" href="http://github.com/mllfe"><i class="fa fa-github"></i></a></li><li><a target="_blank" rel="noopener" href="http://gitee.com/shadow-seen"><i class="fa fa-code-fork"></i></a></li></ul></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/archives">归档</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"></a></li></div><div class="avatar"><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epW6HbP60p4KOibicicFmOdG9SuUVOSeqTOXUynknl90CFuyvdZnribjytAUahjstLgQib29tlNU0C1dOw/132"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3></h3></div><div class="post-content"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>无论是短信消息推送还是程序内的消息推送，在大部分互联网产品中都是重要的组成部分，能在很大程度上提高用户的产品体验。</p>
<p>网页上的消息推送一般使用 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket"><code>websocket</code></a> 进行站内的消息提示。App上一般使用第三方平台提供的收费式的消息推送服务。而微信小程序内部自己集成了一套消息推送的模块，大量的消息推送模板，免费提供给开发者使用。</p>
<p>本节代码并不多，大部分是以图文演示的形式讲述。</p>
<h2 id="选用模板"><a href="#选用模板" class="headerlink" title="选用模板"></a>选用模板</h2><p>在这之前，请确保你已经拥有 <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/">微信公众平台账号</a> 和开发权限。</p>
<ol>
<li>登录 <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/">微信公众平台账号</a>。</li>
<li>进入<strong>订阅消息</strong>。<br><img src="/2022/04/21/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81/select-temp.png" alt="订阅信息"></li>
<li>点击右侧的 <button style="background-color: #07c160;color:#fff;border:none">选用</button> 按钮，选择一个模板。</li>
</ol>
<p>选择完模板之后就能在 <strong>我的模板</strong> 中看到一条模板的记录，复制好要使用的 <strong>模板ID</strong> 就能使用了。</p>
<h2 id="订阅消息"><a href="#订阅消息" class="headerlink" title="订阅消息"></a>订阅消息</h2><p>在你小程序的业务逻辑代码中使用之前复制的 <strong>模板ID</strong> 手动<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api/open-api/subscribe-message/wx.requestSubscribeMessage.html">唤起消息订阅</a>。</p>
<p>服务端根据订单状态调用微信官方提供的 <a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/subscribe-message/subscribeMessage.send.html">推送接口</a> 推送消息给用户。</p>
<p>例：</p>
<p>用户下单购买商品，当前订单会存在如下几种状态需要推送给用户——订单支付成功、订单发货、订单退货。</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// order.js</span></span><br><span class="line">wx.<span class="title function_">requestSubscribeMessage</span>({</span><br><span class="line">  <span class="attr">tmplIds</span>: [</span><br><span class="line">    <span class="string">'订单支付成功模板ID'</span>,</span><br><span class="line">    <span class="string">'订单发货模板ID'</span>,</span><br><span class="line">    <span class="string">'订单退货模板ID'</span>,</span><br><span class="line">  ],</span><br><span class="line">  <span class="title function_">success</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="comment">// 唤起支付</span></span><br><span class="line">    wx.<span class="title function_">requestPayment</span>({</span><br><span class="line">      <span class="comment">//</span></span><br><span class="line">    })</span><br><span class="line">  }</span><br><span class="line">})</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>唤起订阅时，用户需要手动确定是否接受消息推送。接受之后即可等待订单状态变更，后端调用微信接口推送消息。<br><img src="https://res.wx.qq.com/wxdoc/dist/assets/img/subscribe-message-reminder.b26ab3eb.png" alt="是否接受消息推送"></p>
<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>微信提供了很多减少企业开支和开发者劳动力的功能模块，又因微信大量的用户基数，使得现在越来越多的公司做软件时都会考虑做一版微信小程序。而作为前端开发工程师又无法避免的需要接触使用小程序，只能说——活到老，学到老。<span class="github-emoji"><span>😭</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f62d.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span></p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2022-04-21</span><i class="fa fa-tag"></i><a class="tag" href="/tags/微信小程序/" title="微信小程序">微信小程序 </a><a class="tag" href="/tags/消息推送/" title="消息推送">消息推送 </a></div></div></div></div><div class="pagination"><ul class="clearfix"><li class="next pagbuttons"><a class="btn" role="navigation" href="/2022/04/19/Dotenv%E9%85%8D%E7%BD%AE%E9%A1%B9%E7%9B%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/" title="Dotenv配置项目环境变量">下一篇</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>